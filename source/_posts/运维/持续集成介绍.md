---
title: 持续集成介绍
tags:
  - CI/CD
  - 持续集成
categories:
  - 运维
  - devops
abbrlink: 53ff9fdd
date: 2017-07-07 19:28:51
---


# 一、什么是持续集成

这个概念源于`极限编程(XP)`，是XP的12种实践之一，通俗地说，持续集成就是频繁地小步幅地向主干分支合并代码。

![](http://xuh.cn-etc.com/2017/04/16/1492333044202.png!md)


### 1.1 特征

- 自动化
- 单元测试
- 容器/虚拟化
- 版本控制
- 灵魂的反馈机制

### 1.2 优点

- 快速失败

	持续集成最大的有点事`快速失败`，因为是快速的小步幅的合并代码，问题域会更集中，单元测试失败就直接拒绝，避免因提交内容太多造成的集成困难和携带错误发布而导致的发布回滚。

- 防止分支大幅偏离主干

	如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。

### 1.3 持续交付(Continuous Delivery)和持续(Continuous Deployment)


持续交付

![](http://xuh.cn-etc.com/2017/04/16/1492333425508.png!md)

持续部署

![](http://xuh.cn-etc.com/2017/04/16/1492333475513.png!md)


持续集成是持续交付的前提，持续交付是持续部署的前提。

三者在流程上的关系

![](http://xuh.cn-etc.com/2017/04/16/1492333791473.png!md)



> 注意，从上面我们可以看出来，在整个开发流程中，最重要的环节是持续集成，另外为了表述简便，在以后的文档中不会再可以提持续交付和持续部署，而是不严格的用持续集成代替整个流程或者用应为`CI/CD`指代整个流程。


### 1.4 持续集成构建方案(工具)


从上面的整个持续集成的流程来看，都是自动化的，人工去完成这个过程显然不现实，因此就有各种各样的继续集成的构建工具，常见的以下几种


- Jenkins
- Gitlab
- Travis
- Strider
- Codeship


# 二、Gitlab中CI/CD相关概念

## 一些基本概念

gitlab中通过根目录下的.gitlab-ci.yml配置持续集成任务。为了理解.gitlab-ci.yml，这里简单说明下gitlab中的几个概念

- Pipline

	Pipline是`管道`的意思，一次构建任务就是一个Pipline，一个Pipline可以包括多个Stages。

- Stages

	Stages是`阶段`的意思，就是表示个持续发布流程中的一个环节，比如构建、测试、发布等，Stages是包含多个Jobs（任务）的集合，不包含任何Jobs的Stages会被gitlab-runner自动忽略。
	
	Gitlab默认包含build, test, deploy三个Stages。
	
	Stages按顺序串行执行，任何一个Stages失败，Pipline就失败。

- Jobs

	Jobs在这里是`任务`的意思。
	
	Stages中的Jobs并行执行，任何一个Jobs失败则Stages失败。
	
三者的关系

![](http://xuh.cn-etc.com/2017/04/16/1492335916641.png!md)

Gitlab中用gitlab-runner来执行pipline。

更多请参见官方文档 [https://docs.gitlab.com/ce/ci/#getting-started](https://docs.gitlab.com/ce/ci/#getting-started)

## gitlab持续集成服务器拓扑

![](http://xuh.cn-etc.com/2017/07/07/1499427782517.png!md)



