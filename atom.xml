<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>金州苍狼</title>
  <subtitle>向往浪迹天涯的技术宅</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xuh.io/"/>
  <updated>2017-05-29T03:33:22.000Z</updated>
  <id>http://xuh.io/</id>
  
  <author>
    <name>David.xu</name>
    <email>xuh86@126.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>让nginx支持path_info</title>
    <link href="http://xuh.io/2015/11/28/%E8%AE%A9nginx%E6%94%AF%E6%8C%81path-info/"/>
    <id>http://xuh.io/2015/11/28/让nginx支持path-info/</id>
    <published>2015-11-28T03:21:44.000Z</published>
    <updated>2017-05-29T03:33:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>nginx默认是不支持path_info模式的，也就是说不支持index.php/*这样的url，因此像Thinkphp中URL model为2的那种路径方式nginx不支持。</p>
<p>只要修改虚拟主机的下面三个地方即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">location ~ .php &#123; #删除.php后的$</div><div class="line">         fastcgi_pass   soopj_phpfcgi;</div><div class="line">         fastcgi_index  default.php;</div><div class="line">          </div><div class="line">         fastcgi_split_path_info ^((?U).+.php)(/?.+)$;       #增加这句</div><div class="line">         fastcgi_param PATH_INFO $fastcgi_path_info;   #增加这句</div><div class="line">    </div><div class="line">         fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;</div><div class="line">         include        fastcgi_params;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nginx默认是不支持path_info模式的，也就是说不支持index.php/*这样的url，因此像Thinkphp中URL model为2的那种路径方式nginx不支持。&lt;/p&gt;
&lt;p&gt;只要修改虚拟主机的下面三个地方即可：&lt;/p&gt;
&lt;figure class=&quot;hig
    
    </summary>
    
      <category term="运维" scheme="http://xuh.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="LA/NMP服务" scheme="http://xuh.io/categories/%E8%BF%90%E7%BB%B4/LA-NMP%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="nginx" scheme="http://xuh.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>CentOS安装samba服务</title>
    <link href="http://xuh.io/2015/11/28/CentOS%E5%AE%89%E8%A3%85samba%E6%9C%8D%E5%8A%A1/"/>
    <id>http://xuh.io/2015/11/28/CentOS安装samba服务/</id>
    <published>2015-11-28T03:21:44.000Z</published>
    <updated>2017-05-29T03:38:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>检查是否有安装samba服务：</p>
<p><code>$ rpm -qa | grep samba</code></p>
<p>如果没安装则yum安装</p>
<p><code>$ yum -y install samba samba-client samba-common</code></p>
<p>默认的安装目录是/etc/samba，配置文件为smb.conf,先备份下smb文件<br><code>$ cd /etc/samba</code><br><code>$ cp smb.conf smb.conf.bak</code></p>
<p>然后编辑smb.conf加入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[remote_dev]</div><div class="line">        path = /alidata/nginx_www/wx.soopj.com</div><div class="line">        public =no</div><div class="line">        writable = yes</div><div class="line">        write list = @www  </div><div class="line">        valid users = @www</div></pre></td></tr></table></figure>
<p>@www是客户端登录所需要的用户，设置nginx的用户密码：</p>
<p><code>$ smbpasswd -a www</code></p>
<p>为了避免在启动Samba时出现以下警告信息：rlimit_max: increasing rlimit_max (1024) tominimum Windows limit (16384)，<br>配置内核参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$ ulimit -n 16384</div><div class="line">$ vi /etc/security/limits.conf</div><div class="line">#在最后加入以下内容</div><div class="line">* - nofile 16384</div></pre></td></tr></table></figure>
<p>然后运行testparm检测配置文件。</p>
<p>然后启动服务，关闭防火墙：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ service smb start</div><div class="line">$ service nmb start</div><div class="line">$ service iptables stop</div></pre></td></tr></table></figure>
<p>centos7后启动服务由systemctl管理，防火墙换成firewalld，因此命令稍有不同。然后客户端即可测试。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;检查是否有安装samba服务：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ rpm -qa | grep samba&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果没安装则yum安装&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ yum -y install samba samba-client samba-comm
    
    </summary>
    
      <category term="运维" scheme="http://xuh.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="系统管理" scheme="http://xuh.io/categories/%E8%BF%90%E7%BB%B4/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="samba" scheme="http://xuh.io/tags/samba/"/>
    
  </entry>
  
  <entry>
    <title>一个 git hook自动部署脚本</title>
    <link href="http://xuh.io/2015/11/28/%E4%B8%80%E4%B8%AA-git-hook%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/"/>
    <id>http://xuh.io/2015/11/28/一个-git-hook自动部署脚本/</id>
    <published>2015-11-28T03:21:44.000Z</published>
    <updated>2017-05-29T04:10:12.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><figcaption><span>http://www.ihorve.com/?p=234</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash">!/bin/sh</span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> git autodeploy script when it matches string <span class="string">"[deploy]"</span></span></div><div class="line"><span class="meta">#</span><span class="bash"></span></div><div class="line"><span class="meta">#</span><span class="bash"> Usage:</span></div><div class="line"><span class="meta">#</span><span class="bash">    1. put this into the post-receive hook file itself below</span></div><div class="line"><span class="meta">#</span><span class="bash">    2. `chmod +x post-receive`</span></div><div class="line"><span class="meta">#</span><span class="bash">    3. Done!</span></div><div class="line"><span class="meta">#</span><span class="bash"> Check the remote git repository whether it is bare</span></div><div class="line">IS_BARE=$(git rev-parse --is-bare-repository)</div><div class="line">if [ -z "$IS_BARE" ]; then</div><div class="line">    echo &gt;&amp;2 "fatal:post-receive:IS_NOT_BARE"</div><div class="line">    exit 1</div><div class="line">fi</div><div class="line"><span class="meta">#</span><span class="bash"> Get the latest commit subject</span></div><div class="line">SUBJECT=$(git log -1 --pretty=format:"%s")</div><div class="line"><span class="meta">#</span><span class="bash"> Deploy the HEAD <span class="built_in">source</span> to publish</span></div><div class="line">IS_PULL=$(echo "$SUBJECT"  | grep "\[deploy\]")</div><div class="line">if [ -z "$IS_PULL" ];then</div><div class="line">    echo &gt;&amp;2 "tips:post-receive:IS_NOT_PULL"</div><div class="line">    exit 1</div><div class="line">fi</div><div class="line"><span class="meta">#</span><span class="bash"> Check the deploy dir whether is exists</span></div><div class="line">DEPLOY_DIR=/home/www</div><div class="line">if [ ! -d $DEPLOY_DIR ]; then</div><div class="line">    echo &gt;&amp;2 "fatal:post-receive:DEPLOY_DIR_NOT_EXISTS:\"$DEPLOY_DIR\""</div><div class="line">    exit 1</div><div class="line">fi</div><div class="line"><span class="meta">#</span><span class="bash"> Check the deploy dir whether it is git repository</span></div><div class="line"><span class="meta">#</span><span class="bash">IS_GIT=$(git rev-parse --git-dir 2&gt;/dev/null)</span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$IS_GIT</span>"</span> ] ;<span class="keyword">then</span></span></div><div class="line"><span class="meta">#</span><span class="bash">    <span class="built_in">echo</span> &gt;&amp;2 <span class="string">"fatal:post-receive:IS_NOT_GIT"</span></span></div><div class="line"><span class="meta">#</span><span class="bash">    <span class="built_in">exit</span> 1</span></div><div class="line"><span class="meta">#</span><span class="bash"><span class="keyword">fi</span></span></div><div class="line"><span class="meta">#</span><span class="bash"> Goto the deploy dir and pull the latest sources</span></div><div class="line">cd $DEPLOY_DIR</div><div class="line"><span class="meta">#</span><span class="bash"> env -i git reset --hard</span></div><div class="line">env -i git pull</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;http://www.ihorve.com/?p=234&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div cl
    
    </summary>
    
      <category term="工具/版本管理" scheme="http://xuh.io/categories/%E5%B7%A5%E5%85%B7-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="git" scheme="http://xuh.io/tags/git/"/>
    
      <category term="webhook" scheme="http://xuh.io/tags/webhook/"/>
    
  </entry>
  
</feed>
